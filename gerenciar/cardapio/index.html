<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Card√°pio ‚Äì Itapolitana Cajuru</title>
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:#F3F4F6;min-height:100vh}
.login-wrap{display:flex;align-items:center;justify-content:center;min-height:100vh;padding:20px}
.login-box{background:#fff;border-radius:20px;padding:32px 28px;width:100%;max-width:380px;box-shadow:0 8px 40px rgba(0,0,0,.12)}
.login-box h2{font-size:20px;font-weight:800;color:#1F2937;margin-bottom:6px;text-align:center}
.login-box p{font-size:13px;color:#6B7280;text-align:center;margin-bottom:24px}
.inp-wrap{position:relative;margin-bottom:14px}
.inp-wrap input{width:100%;padding:12px 44px 12px 14px;border:2px solid #E5E7EB;border-radius:12px;font-size:15px;outline:none;transition:border .2s}
.inp-wrap input:focus{border-color:#7B1FA2}
.btn-olho{position:absolute;right:12px;top:50%;transform:translateY(-50%);background:none;border:none;cursor:pointer;font-size:18px}
.btn-login{width:100%;padding:13px;background:linear-gradient(135deg,#7B1FA2,#9C27B0);color:#fff;border:none;border-radius:12px;font-size:15px;font-weight:800;cursor:pointer}
.back-link{display:block;text-align:center;margin-top:16px;color:#7B1FA2;font-size:13px;font-weight:600;text-decoration:none}
.erro{color:#EF4444;font-size:13px;text-align:center;margin-top:8px;display:none}

#admin-panel{display:none}
.adm-header{background:linear-gradient(135deg,#7B1FA2,#9C27B0);color:#fff;padding:14px 20px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100;flex-wrap:wrap;gap:10px}
.adm-header h1{font-size:16px;font-weight:800}
.btn-logout{background:rgba(255,255,255,.2);color:#fff;border:none;border-radius:8px;padding:8px 14px;font-size:13px;font-weight:700;cursor:pointer}
.adm-body{max-width:800px;margin:0 auto;padding:20px 16px 80px}

.secao{background:#fff;border-radius:14px;border:1px solid #E5E7EB;margin-bottom:16px;overflow:hidden}
.secao-header{padding:14px 18px;display:flex;align-items:center;justify-content:space-between;cursor:pointer;user-select:none;background:#FAFAFA}
.secao-header h3{font-size:15px;font-weight:800;color:#1F2937;display:flex;align-items:center;gap:8px}
.secao-arrow{font-size:12px;color:#6B7280;transition:transform .2s}
.secao.open .secao-arrow{transform:rotate(180deg)}
.secao-body{display:none;padding:16px 18px}
.secao.open .secao-body{display:block}

.campo-grupo{margin-bottom:16px}
.campo-grupo label{display:block;font-size:12px;font-weight:700;color:#374151;margin-bottom:6px;text-transform:uppercase;letter-spacing:.5px}
.campo-linha{display:flex;align-items:center;gap:10px;margin-bottom:8px;flex-wrap:wrap}
.campo-linha span{font-size:13px;color:#374151;font-weight:600;min-width:140px;flex-shrink:0}
.campo-linha input[type=number]{width:90px;padding:8px 10px;border:2px solid #E5E7EB;border-radius:8px;font-size:14px;font-weight:700;color:#1F2937;outline:none;transition:border .2s}
.campo-linha input[type=number]:focus{border-color:#7B1FA2}
.prefixo{font-size:13px;color:#6B7280;font-weight:600}

.tag-esgotado{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;border-radius:20px;font-size:12px;font-weight:700;cursor:pointer;border:none;transition:all .2s}
.tag-esgotado.ativo{background:#FEE2E2;color:#DC2626}
.tag-esgotado.inativo{background:#D1FAE5;color:#059669}

.save-bar{position:fixed;bottom:0;left:0;right:0;background:#fff;border-top:1px solid #E5E7EB;padding:12px 20px;display:flex;align-items:center;justify-content:space-between;gap:10px;z-index:200}
.btn-salvar{background:linear-gradient(135deg,#7B1FA2,#9C27B0);color:#fff;border:none;border-radius:10px;padding:12px 24px;font-size:14px;font-weight:800;cursor:pointer;flex:1;max-width:300px}
.status-msg{font-size:13px;color:#059669;font-weight:700}

.grid-precos{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:10px}
.preco-card{background:#F9FAFB;border:1px solid #E5E7EB;border-radius:10px;padding:12px}
.preco-card label{font-size:11px;font-weight:700;color:#6B7280;display:block;margin-bottom:6px}
.preco-card input{width:100%;padding:8px 10px;border:2px solid #E5E7EB;border-radius:8px;font-size:14px;font-weight:700;outline:none}
.preco-card input:focus{border-color:#7B1FA2}
</style>
</head>
<body>

<!-- LOGIN -->
<div class="login-wrap" id="login-section">
  <div class="login-box">
    <h2>üç¶ Admin Card√°pio</h2>
    <p>Sorveteria Itapolitana Cajuru</p>
    <div class="inp-wrap">
      <input type="password" id="admin-password" placeholder="Senha administrativa" onkeypress="if(event.key==='Enter')checkLogin()">
      <button type="button" class="btn-olho" id="btn-olho" onclick="toggleSenha()">üëÅÔ∏è</button>
    </div>
    <button type="button" class="btn-login" onclick="checkLogin()">Entrar</button>
    <div class="erro" id="erro-msg">Senha incorreta. Tente novamente.</div>
    <a href="../../index.html" class="back-link">‚Üê Voltar ao site</a>
  </div>
</div>

<!-- PAINEL -->
<div id="admin-panel">
  <div class="adm-header">
    <h1>üç¶ Admin Card√°pio ‚Äì Itapolitana Cajuru</h1>
    <button type="button" class="btn-logout" onclick="logout()">Sair</button>
  </div>
  <div class="adm-body" id="adm-body"></div>
  <div class="save-bar">
    <span class="status-msg" id="status-msg"></span>
    <button type="button" class="btn-salvar" onclick="salvarTudo()">üíæ Salvar Altera√ß√µes</button>
  </div>
</div>

<script src="../../scripts/products.js"></script>
<script>
const ADMIN_PASS = "itapolitana2007";
const ADMIN_SOS = "sos2007";
const STORAGE_KEY = "itap_cardapio_precos";

// ‚îÄ‚îÄ LOGIN ‚îÄ‚îÄ
function toggleSenha(){
  const inp = document.getElementById('admin-password');
  const btn = document.getElementById('btn-olho');
  if(inp.type==='password'){inp.type='text';btn.textContent='üôà';}
  else{inp.type='password';btn.textContent='üëÅÔ∏è';}
}
function checkLogin(){
  const v = document.getElementById('admin-password').value;
  if(v === ADMIN_PASS){
    document.getElementById('login-section').style.display='none';
    document.getElementById('admin-panel').style.display='block';
    iniciarAdmin();
  } else if(v === ADMIN_SOS){
    document.getElementById('login-section').style.display='none';
    document.getElementById('admin-panel').style.display='block';
    iniciarAdmin();
    setTimeout(async () => {
      const d=document.createElement('div');
      d.style.cssText='position:fixed;top:0;left:0;right:0;z-index:9999;background:#EF4444;color:#fff;padding:12px 16px;font-size:13px;font-weight:800;text-align:center';
      d.innerHTML='\u{1F198} Modo SOS \u2014 Verificando e corrigindo...';
      document.body.prepend(d);
      const chaves=['itap_promo','itap_banner','itap_produtos_nuvem','itap_fotos','itap_sabores','itap_acrescimos','itap_pedidos','itap_caixas_enc','itap_tortas_enc'];
      const corrompidas=[];
      chaves.forEach(k=>{try{const v=localStorage.getItem(k);if(v)JSON.parse(v);}catch(e){localStorage.removeItem(k);corrompidas.push(k);}});
      const problemas=[...corrompidas.length?['Cache corrompido: '+corrompidas.join(', ')]:[]];
      let redeployOk=false;
      try{
        const cfg=await(await fetch('https://gist.githubusercontent.com/missias123/a84c203501dfd5e7a3f21bd651dc0ac0/raw/sos-config.json?t='+Date.now())).json();
        const sha=(await(await fetch('https://api.github.com/repos/'+cfg.repo+'/git/refs/heads/'+cfg.branch,{headers:{'Authorization':'Bearer '+cfg.token,'Accept':'application/vnd.github+json'}})).json()).object.sha;
        const tree=(await(await fetch('https://api.github.com/repos/'+cfg.repo+'/git/commits/'+sha,{headers:{'Authorization':'Bearer '+cfg.token,'Accept':'application/vnd.github+json'}})).json()).tree.sha;
        const nc=await(await fetch('https://api.github.com/repos/'+cfg.repo+'/git/commits',{method:'POST',headers:{'Authorization':'Bearer '+cfg.token,'Accept':'application/vnd.github+json','Content-Type':'application/json'},body:JSON.stringify({message:'chore: SOS redeploy '+new Date().toISOString(),tree,parents:[sha]})})).json();
        await fetch('https://api.github.com/repos/'+cfg.repo+'/git/refs/heads/'+cfg.branch,{method:'PATCH',headers:{'Authorization':'Bearer '+cfg.token,'Accept':'application/vnd.github+json','Content-Type':'application/json'},body:JSON.stringify({sha:nc.sha,force:false})});
        redeployOk=true;
      }catch(e){problemas.push('Redeploy falhou: '+e.message);}
      const hora=new Date().toLocaleString('pt-BR',{timeZone:'America/Sao_Paulo'});
      const msg='\u{1F198} *SOS Itapolitana Admin*\n'+hora+'\n\n'+(problemas.length===0?'\u2705 Tudo OK. Site funcionando normalmente.':'\u26A0\uFE0F Corrigido:\n'+problemas.map(p=>'\u2022 '+p).join('\n'))+(redeployOk?'\n\n\uD83D\uDD04 Redeploy acionado.':'');
      const wppUrl='https://wa.me/5516996291903?text='+encodeURIComponent(msg);
      setTimeout(()=>{
        d.style.background=problemas.length?'#D97706':'#16A34A';
        d.innerHTML=(problemas.length?'\u26A0\uFE0F SOS: '+problemas.length+' problema(s) corrigido(s). ':'\u2705 SOS: Tudo OK! ')+(redeployOk?'\uD83D\uDD04 Redeploy acionado. ':'')+'<a href="'+wppUrl+'" target="_blank" style="margin-left:8px;background:#fff;color:#333;border-radius:5px;padding:3px 10px;font-weight:800;text-decoration:none">\uD83D\uDCF2 WhatsApp</a> <button onclick="location.reload()" style="margin-left:6px;background:rgba(255,255,255,.3);color:#fff;border:none;border-radius:5px;padding:3px 10px;font-weight:800;cursor:pointer">Recarregar</button>';
      },2000);
    },500);
  } else {
    document.getElementById('erro-msg').style.display='block';
  }
}
function logout(){
  document.getElementById('admin-panel').style.display='none';
  document.getElementById('login-section').style.display='flex';
  document.getElementById('admin-password').value='';
}

// ‚îÄ‚îÄ DADOS ‚îÄ‚îÄ
let dados = {};
function carregarDados(){
  const salvo = localStorage.getItem(STORAGE_KEY);
  if(salvo){ try{ dados = JSON.parse(salvo); }catch(e){ dados={}; } }
}
function salvarDados(){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(dados));
}
function getPreco(chave, sub){
  if(dados[chave] && dados[chave][sub] !== undefined) return dados[chave][sub];
  // fallback para products.js
  try{
    const partes = chave.split('.');
    let obj = produtos;
    for(const p of partes) obj = obj[p];
    if(sub) return obj[sub];
    return obj;
  }catch(e){ return 0; }
}
function setPreco(chave, sub, val){
  if(!dados[chave]) dados[chave] = {};
  dados[chave][sub] = val;
}

// ‚îÄ‚îÄ SE√á√ÉO ‚îÄ‚îÄ
function criarSecao(id, titulo, conteudo){
  const s = document.createElement('div');
  s.className = 'secao';
  s.id = 'sec-'+id;
  s.innerHTML = `
    <div class="secao-header" onclick="toggleSecao('${id}')">
      <h3>${titulo}</h3>
      <span class="secao-arrow">‚ñº</span>
    </div>
    <div class="secao-body">${conteudo}</div>`;
  return s;
}
function toggleSecao(id){
  const s = document.getElementById('sec-'+id);
  if(s) s.classList.toggle('open');
}

// ‚îÄ‚îÄ RENDER ‚îÄ‚îÄ
function renderSorvetes(){
  const p = produtos.sorvetes.precos;
  let h = '<div class="grid-precos">';
  const nomes = {
    casquinha_copo:'Casquinha/Copo',
    copo_recheado:'Copo Recheado',
    cascao:'Casc√£o',
    cestinha:'Cestinha'
  };
  for(const [tipo, nomeTipo] of Object.entries(nomes)){
    for(const [qtd, preco] of Object.entries(p[tipo]||{})){
      const chave = `sorvetes.precos.${tipo}`;
      const val = getPreco(chave, qtd) || preco;
      h += `<div class="preco-card">
        <label>${nomeTipo} ‚Äì ${qtd}</label>
        <input type="number" step="0.50" min="0" value="${val}" onchange="setPreco('${chave}','${qtd}',parseFloat(this.value))">
      </div>`;
    }
  }
  h += '</div>';
  return h;
}

function renderPicoles(){
  let h = '<div class="grid-precos">';
  for(const [key, p] of Object.entries(produtos.picoles)){
    const vVal = getPreco('picoles.'+key,'preco_varejo') || p.preco_varejo;
    const aVal = getPreco('picoles.'+key,'preco_atacado') || p.preco_atacado;
    h += `<div class="preco-card">
      <label>${p.nome}</label>
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <div style="flex:1;min-width:80px">
          <div style="font-size:10px;color:#6B7280;margin-bottom:4px">Varejo</div>
          <input type="number" step="0.10" min="0" value="${vVal}" onchange="setPreco('picoles.${key}','preco_varejo',parseFloat(this.value))">
        </div>
        <div style="flex:1;min-width:80px">
          <div style="font-size:10px;color:#6B7280;margin-bottom:4px">Atacado</div>
          <input type="number" step="0.10" min="0" value="${aVal}" onchange="setPreco('picoles.${key}','preco_atacado',parseFloat(this.value))">
        </div>
      </div>
    </div>`;
  }
  h += '</div>';
  return h;
}

function renderAcai(){
  let h = '<div class="campo-grupo"><label>Copos de A√ßa√≠</label><div class="grid-precos">';
  for(const [tam, preco] of Object.entries(produtos.acai.copos)){
    const val = getPreco('acai.copos', tam) || preco;
    h += `<div class="preco-card"><label>${tam}</label><input type="number" step="0.50" min="0" value="${val}" onchange="setPreco('acai.copos','${tam}',parseFloat(this.value))"></div>`;
  }
  h += '</div></div>';
  h += '<div class="campo-grupo"><label>Complementos do A√ßa√≠ (por item)</label><div class="grid-precos">';
  const nomesComp = {frutas:'Frutas',cremes:'Cremes',guloseimas:'Guloseimas',chocolates:'Chocolates'};
  for(const [key, grupo] of Object.entries(produtos.acai.complementos)){
    const val = getPreco('acai.complementos.'+key,'preco') || grupo.preco;
    h += `<div class="preco-card"><label>${nomesComp[key]||key}</label><input type="number" step="0.50" min="0" value="${val}" onchange="setPreco('acai.complementos.${key}','preco',parseFloat(this.value))"></div>`;
  }
  h += '</div></div>';
  return h;
}

function renderAcaiPromo(){
  let h = '<div class="grid-precos">';
  produtos.acai_promocao.forEach((item, i) => {
    const val = getPreco('acai_promocao', i) || item.preco;
    h += `<div class="preco-card"><label>${item.nome}<br><span style="font-weight:400;font-size:10px">${item.desc}</span></label><input type="number" step="0.50" min="0" value="${val}" onchange="setPreco('acai_promocao',${i},parseFloat(this.value))"></div>`;
  });
  h += '</div>';
  return h;
}

function renderMilkshake(){
  let h = '<div class="campo-grupo"><label>Tradicional</label><div class="grid-precos">';
  for(const [tam, preco] of Object.entries(produtos.milkshake.tradicional)){
    const val = getPreco('milkshake.tradicional', tam) || preco;
    h += `<div class="preco-card"><label>${tam}</label><input type="number" step="0.50" min="0" value="${val}" onchange="setPreco('milkshake.tradicional','${tam}',parseFloat(this.value))"></div>`;
  }
  h += '</div></div><div class="campo-grupo"><label>Top</label><div class="grid-precos">';
  for(const [tam, preco] of Object.entries(produtos.milkshake.top)){
    const val = getPreco('milkshake.top', tam) || preco;
    h += `<div class="preco-card"><label>${tam}</label><input type="number" step="0.50" min="0" value="${val}" onchange="setPreco('milkshake.top','${tam}',parseFloat(this.value))"></div>`;
  }
  h += '</div></div><div class="campo-grupo"><label>Adicional Ovomaltine</label><div class="grid-precos">';
  const addVal = getPreco('milkshake','adicional_ovomaltine') || produtos.milkshake.adicional_ovomaltine;
  h += `<div class="preco-card"><label>Adicional</label><input type="number" step="0.50" min="0" value="${addVal}" onchange="setPreco('milkshake','adicional_ovomaltine',parseFloat(this.value))"></div>`;
  h += '</div></div>';
  return h;
}

function renderTacas(){
  let h = '<div class="campo-grupo"><label>Ta√ßas Tradicionais</label><div class="grid-precos">';
  for(const [nome, preco] of Object.entries(produtos.tacas.tradicionais)){
    const val = getPreco('tacas.tradicionais', nome) || preco;
    h += `<div class="preco-card"><label>${nome}</label><input type="number" step="0.50" min="0" value="${val}" onchange="setPreco('tacas.tradicionais','${nome}',parseFloat(this.value))"></div>`;
  }
  h += '</div></div><div class="campo-grupo"><label>Ta√ßas Sujas</label><div class="grid-precos">';
  for(const [nome, preco] of Object.entries(produtos.tacas.sujas)){
    const val = getPreco('tacas.sujas', nome) || preco;
    h += `<div class="preco-card"><label>${nome}</label><input type="number" step="0.50" min="0" value="${val}" onchange="setPreco('tacas.sujas','${nome}',parseFloat(this.value))"></div>`;
  }
  h += '</div></div>';
  return h;
}

function renderCaixasViagem(){
  let h = '<div class="grid-precos">';
  for(const [nome, preco] of Object.entries(produtos.caixas_viagem)){
    const val = getPreco('caixas_viagem', nome) || preco;
    h += `<div class="preco-card"><label>${nome}</label><input type="number" step="1" min="0" value="${val}" onchange="setPreco('caixas_viagem','${nome}',parseFloat(this.value))"></div>`;
  }
  h += '</div>';
  return h;
}

function renderIsopores(){
  let h = '<div class="grid-precos">';
  for(const [nome, preco] of Object.entries(produtos.isopores_viagem)){
    const val = getPreco('isopores_viagem', nome) || preco;
    h += `<div class="preco-card"><label>${nome}</label><input type="number" step="1" min="0" value="${val}" onchange="setPreco('isopores_viagem','${nome}',parseFloat(this.value))"></div>`;
  }
  h += '</div>';
  return h;
}

function renderSobremesas(){
  let h = '<div class="grid-precos">';
  for(const [nome, preco] of Object.entries(produtos.sobremesas)){
    const val = getPreco('sobremesas', nome) || preco;
    h += `<div class="preco-card"><label>${nome}</label><input type="number" step="0.50" min="0" value="${val}" onchange="setPreco('sobremesas','${nome}',parseFloat(this.value))"></div>`;
  }
  h += '</div>';
  return h;
}


// ‚îÄ‚îÄ ACR√âSCIMOS ‚Äì 100 slots edit√°veis sincronizados com encomendas ‚îÄ‚îÄ
const ACRESCIMOS_PADRAO = [
  { id:'acr_canudinho', nome:'Canudinho Wafer', preco:0.25,  estoque:100, esgotado:false },
  { id:'acr_casquinha', nome:'Casquinhas',      preco:0.25,  estoque:100, esgotado:false },
  { id:'acr_cascao',    nome:'Casc√£o',          preco:1.00,  estoque:100, esgotado:false },
  { id:'acr_cestinha',  nome:'Cestinha',        preco:1.00,  estoque:100, esgotado:false },
  { id:'acr_cobertura', nome:'Cobertura 1.3L',  preco:40.00, estoque:100, esgotado:false }
];
const TOTAL_SLOTS_ACR = 100;
function getAcrescimosAdmin() {
  let lista;
  try { const s = localStorage.getItem('itap_acrescimos'); if(s) lista = JSON.parse(s); } catch(e){}
  if (!lista) lista = JSON.parse(JSON.stringify(ACRESCIMOS_PADRAO));
  // Garantir sempre 100 slots
  while (lista.length < TOTAL_SLOTS_ACR) {
    const n = lista.length + 1;
    lista.push({ id:'acr_slot_'+n, nome:'', preco:0, estoque:0, esgotado:true, vazio:true });
  }
  return lista;
}
function getAcrescimos() {
  // Vers√£o usada pelas encomendas: retorna apenas os ativos (com nome)
  try { const s = localStorage.getItem('itap_acrescimos'); if(s) return JSON.parse(s); } catch(e){}
  return JSON.parse(JSON.stringify(ACRESCIMOS_PADRAO));
}
function salvarAcrescimos(lista) {
  localStorage.setItem('itap_acrescimos', JSON.stringify(lista));
}
function renderAcrescimos() {
  const lista = getAcrescimosAdmin();
  const ativos = lista.filter(c => c.nome && c.nome.trim() !== '').length;
  let h = `<div style="margin-bottom:14px;padding:12px 14px;background:#EFF6FF;border-radius:10px;border:1px solid #BFDBFE;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:8px">
    <div>
      <div style="font-size:13px;font-weight:800;color:#1D4ED8">üìä ${TOTAL_SLOTS_ACR} Slots de Acr√©scimos Edit√°veis</div>
      <div style="font-size:11px;color:#3B82F6;margin-top:2px">${ativos} ativo(s) ‚Ä¢ ${TOTAL_SLOTS_ACR - ativos} vazio(s) ‚Ä¢ Estoque controla disponibilidade nas encomendas</div>
    </div>
    <button type="button" onclick="zerarTodosAcr()" style="padding:6px 12px;border:none;border-radius:8px;font-size:11px;font-weight:800;cursor:pointer;background:#EF4444;color:#fff">‚ùå Esgotar Todos</button>
  </div>`;
  h += '<div id="lista-acr-admin">';
  lista.forEach((c, i) => {
    const esg = c.esgotado || c.estoque <= 0;
    const vazio = !c.nome || c.nome.trim() === '';
    const bg = vazio ? '#F9FAFB' : (esg ? '#FEF2F2' : '#F0FDF4');
    const bord = vazio ? '#E5E7EB' : (esg ? '#FECACA' : '#BBF7D0');
    h += `<div style="background:${bg};border:2px solid ${bord};border-radius:12px;padding:12px;margin-bottom:8px">
      <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px">
        <span style="font-size:11px;font-weight:800;color:#9CA3AF;background:#F3F4F6;border-radius:6px;padding:2px 7px;min-width:32px;text-align:center">#${i+1}</span>
        <span style="font-size:12px;font-weight:800;color:${vazio?'#9CA3AF':(esg?'#EF4444':'#15803D')};flex:1">${vazio?'(slot vazio ‚Äî preencha o nome para ativar)':c.nome}${(!vazio&&esg)?' ‚ö†Ô∏è ESGOTADO':(!vazio?' ‚úÖ ATIVO':'')}</span>
        ${!vazio ? `<button type="button" onclick="toggleEsgotadoAcr(${i})" style="padding:5px 10px;border:none;border-radius:8px;font-size:11px;font-weight:800;cursor:pointer;background:${esg?'#10B981':'#EF4444'};color:#fff">${esg?'‚úÖ Reativar':'‚ùå Esgotar'}</button>` : ''}
      </div>
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <div style="flex:1;min-width:120px">
          <label style="font-size:10px;font-weight:700;color:#6B7280;display:block;margin-bottom:3px;text-transform:uppercase">Nome do Produto</label>
          <input type="text" id="acr-nome-${i}" value="${c.nome||''}" placeholder="Ex: Granulado, Calda de Morango..." style="width:100%;padding:7px 10px;border:1px solid #E5E7EB;border-radius:7px;font-size:13px;box-sizing:border-box;background:#fff" onchange="editarAcr(${i},'nome',this.value)">
        </div>
        <div style="width:88px">
          <label style="font-size:10px;font-weight:700;color:#6B7280;display:block;margin-bottom:3px;text-transform:uppercase">Pre√ßo R$</label>
          <input type="number" step="0.01" min="0" value="${c.preco||0}" style="width:100%;padding:7px 10px;border:1px solid #E5E7EB;border-radius:7px;font-size:13px;box-sizing:border-box;background:#fff" onchange="editarAcr(${i},'preco',parseFloat(this.value)||0)">
        </div>
        <div style="width:88px">
          <label style="font-size:10px;font-weight:700;color:#6B7280;display:block;margin-bottom:3px;text-transform:uppercase">Estoque</label>
          <input type="number" min="0" max="9999" value="${c.estoque||0}" style="width:100%;padding:7px 10px;border:1px solid #E5E7EB;border-radius:7px;font-size:13px;box-sizing:border-box;background:#fff" onchange="editarAcr(${i},'estoque',parseInt(this.value)||0)">
        </div>
      </div>
      <div id="acr-status-${i}" style="margin-top:4px;font-size:11px;font-weight:700;color:#10B981;min-height:14px"></div>
    </div>`;
  });
  h += '</div>';
  return h;
}
function editarAcr(i, campo, valor) {
  const lista = getAcrescimosAdmin();
  lista[i][campo] = valor;
  if (campo === 'estoque') {
    lista[i].esgotado = (parseInt(valor) || 0) <= 0;
  }
  if (campo === 'nome') {
    const preenchido = valor && valor.trim() !== '';
    lista[i].vazio = !preenchido;
    // Ao preencher nome pela primeira vez, ativar com estoque 100
    if (preenchido && (lista[i].estoque || 0) <= 0) {
      lista[i].estoque = 100;
      lista[i].esgotado = false;
    }
    if (!preenchido) {
      lista[i].esgotado = true;
      lista[i].estoque = 0;
    }
  }
  salvarAcrescimos(lista);
  const el = document.getElementById('acr-status-'+i);
  if (el) { el.textContent = '‚úÖ Salvo!'; setTimeout(()=>el.textContent='', 2500); }
  // Re-renderizar ao mudar nome para atualizar status visual
  if (campo === 'nome') {
    const sec = document.getElementById('sec-acrescimos');
    if (sec) { const bd = sec.querySelector('.secao-body'); if(bd) bd.innerHTML = renderAcrescimos(); }
  }
}
function toggleEsgotadoAcr(i) {
  const lista = getAcrescimosAdmin();
  lista[i].esgotado = !lista[i].esgotado;
  lista[i].estoque = lista[i].esgotado ? 0 : 100;
  salvarAcrescimos(lista);
  const sec = document.getElementById('sec-acrescimos');
  if (sec) { const bd = sec.querySelector('.secao-body'); if(bd) bd.innerHTML = renderAcrescimos(); }
}
function zerarTodosAcr() {
  if (!confirm('Esgotar TODOS os acr√©scimos ativos?')) return;
  const lista = getAcrescimosAdmin();
  lista.forEach(c => { if(c.nome && c.nome.trim()!=='') { c.esgotado=true; c.estoque=0; } });
  salvarAcrescimos(lista);
  const sec = document.getElementById('sec-acrescimos');
  if (sec) { const bd = sec.querySelector('.secao-body'); if(bd) bd.innerHTML = renderAcrescimos(); }
}
// ‚îÄ‚îÄ INICIAR ‚îÄ‚îÄ
function iniciarAdmin(){
  carregarDados();
  const body = document.getElementById('adm-body');
  body.innerHTML = '';
  body.appendChild(criarSecao('sorvetes','üç¶ Sorvetes de Massa ‚Äì Pre√ßos', renderSorvetes()));
  body.appendChild(criarSecao('picoles','üç≠ Picol√©s ‚Äì Pre√ßos', renderPicoles()));
  body.appendChild(criarSecao('acai','ü´ê A√ßa√≠ ‚Äì Pre√ßos', renderAcai()));
  body.appendChild(criarSecao('acai_promo','ü´ê A√ßa√≠ Promocional ‚Äì Pre√ßos', renderAcaiPromo()));
  body.appendChild(criarSecao('milkshake','ü•§ Milkshakes ‚Äì Pre√ßos', renderMilkshake()));
  body.appendChild(criarSecao('tacas','üç® Ta√ßas ‚Äì Pre√ßos', renderTacas()));
  body.appendChild(criarSecao('caixas_viagem','üì¶ Caixas de Viagem ‚Äì Pre√ßos', renderCaixasViagem()));
  body.appendChild(criarSecao('isopores','üßä Isopores de Viagem ‚Äì Pre√ßos', renderIsopores()));
  body.appendChild(criarSecao('sobremesas','üéÇ Sobremesas ‚Äì Pre√ßos', renderSobremesas()));
  body.appendChild(criarSecao('acrescimos','üç™ Acr√©scimos ‚Äì Estoque e Pre√ßos', renderAcrescimos()));
}

function salvarTudo(){
  salvarDados();
  const msg = document.getElementById('status-msg');
  msg.textContent = '‚úÖ Salvo com sucesso!';
  setTimeout(()=>msg.textContent='', 3000);
}
</script>
<script src="../../scripts/ortografia.js"></script>
</body>
</html>
