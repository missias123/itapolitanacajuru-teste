<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Estoque de Insumos â€“ Itapolitana Cajuru</title>
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:'Inter',sans-serif;background:#f5f5f8;color:#111827;min-height:100vh}

/* LOGIN */
.login-wrap{display:flex;align-items:center;justify-content:center;min-height:100vh;padding:20px}
.login-box{background:#fff;border-radius:16px;padding:32px 24px;max-width:360px;width:100%;box-shadow:0 4px 24px rgba(0,0,0,.1);text-align:center}
.login-box h2{font-size:20px;font-weight:900;margin-bottom:8px}
.login-box p{font-size:13px;color:#6A0DAD;font-weight:700;margin-bottom:24px}
.login-box input{width:100%;padding:12px 14px;border:1px solid #E5E7EB;border-radius:10px;font-size:15px;margin-bottom:12px;outline:none}
.login-box input:focus{border-color:#6A0DAD}
.btn-login{width:100%;padding:13px;background:#6A0DAD;color:#fff;border:none;border-radius:10px;font-size:15px;font-weight:800;cursor:pointer}
.btn-login:hover{background:#5a0b9d}
.back-link{display:block;margin-top:16px;font-size:13px;color:#6A0DAD;text-decoration:none}

/* HEADER */
#estoque-panel{display:none}
.header{background:linear-gradient(135deg,#1F2937,#374151);color:#fff;padding:14px 20px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100;flex-wrap:wrap;gap:10px}
.header h1{font-size:16px;font-weight:800;display:flex;align-items:center;gap:8px}
.header-btns{display:flex;gap:8px;flex-wrap:wrap}
.btn-logout{background:#EF4444;color:#fff;border:none;border-radius:8px;padding:8px 14px;font-size:13px;font-weight:700;cursor:pointer}
.btn-admin{background:#6A0DAD;color:#fff;border:none;border-radius:8px;padding:8px 14px;font-size:13px;font-weight:700;cursor:pointer;text-decoration:none}

/* BODY */
.body{max-width:1100px;margin:0 auto;padding:20px 16px 120px}

/* TOOLBAR */
.toolbar{background:#fff;border-radius:14px;border:1px solid #E5E7EB;padding:16px 20px;margin-bottom:20px;display:flex;flex-wrap:wrap;gap:12px;align-items:center}
.toolbar-title{font-size:16px;font-weight:900;color:#111827;flex:1;min-width:160px}
.toolbar input[type="text"]{flex:2;min-width:180px;padding:10px 14px;border:2px solid #E5E7EB;border-radius:10px;font-size:14px;outline:none}
.toolbar input[type="text"]:focus{border-color:#6A0DAD}
.btn-add{background:linear-gradient(135deg,#6A0DAD,#9C27B0);color:#fff;border:none;border-radius:10px;padding:10px 20px;font-size:14px;font-weight:800;cursor:pointer;white-space:nowrap}
.btn-add:hover{opacity:.9}

/* FILTROS */
.filtros{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:16px}
.filtro-btn{padding:7px 16px;border-radius:20px;border:2px solid #E5E7EB;background:#fff;font-size:13px;font-weight:700;cursor:pointer;color:#374151;transition:all .2s}
.filtro-btn.ativo{background:#6A0DAD;color:#fff;border-color:#6A0DAD}
.filtro-btn.alerta{border-color:#F59E0B;color:#F59E0B}
.filtro-btn.alerta.ativo{background:#F59E0B;color:#fff}

/* STATS */
.stats{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:12px;margin-bottom:20px}
.stat-card{background:#fff;border-radius:12px;border:1px solid #E5E7EB;padding:14px 16px;text-align:center}
.stat-num{font-size:28px;font-weight:900;color:#6A0DAD}
.stat-label{font-size:12px;color:#6B7280;font-weight:600;margin-top:2px}
.stat-card.alerta .stat-num{color:#F59E0B}
.stat-card.esgotado .stat-num{color:#EF4444}

/* GRID DE ITENS */
.itens-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:14px}

/* CARD DE ITEM */
.item-card{background:#fff;border-radius:14px;border:2px solid #E5E7EB;overflow:hidden;transition:box-shadow .2s;position:relative}
.item-card:hover{box-shadow:0 4px 20px rgba(0,0,0,.1)}
.item-card.alerta{border-color:#F59E0B}
.item-card.esgotado{border-color:#EF4444}

/* FOTO DO ITEM */
.item-foto-area{width:100%;height:130px;background:#F9FAFB;display:flex;align-items:center;justify-content:center;cursor:pointer;position:relative;overflow:hidden;border-bottom:1px solid #E5E7EB}
.item-foto-area:hover .foto-overlay{opacity:1}
.item-foto-area img{width:100%;height:100%;object-fit:cover;display:block}
.foto-overlay{position:absolute;inset:0;background:rgba(106,13,173,.6);display:flex;align-items:center;justify-content:center;opacity:0;transition:opacity .2s;color:#fff;font-size:13px;font-weight:700;flex-direction:column;gap:4px}
.foto-placeholder-icon{font-size:36px;color:#D1D5DB}
.foto-input-hidden{display:none}

/* INFO DO ITEM */
.item-info{padding:12px}
.item-nome{font-size:14px;font-weight:800;color:#111827;margin-bottom:8px;word-break:break-word}
.item-nome-input{width:100%;padding:6px 10px;border:1px solid #E5E7EB;border-radius:7px;font-size:13px;font-weight:700;outline:none;margin-bottom:8px}
.item-nome-input:focus{border-color:#6A0DAD}

/* CONTADOR */
.contador{display:flex;align-items:center;gap:8px;margin-bottom:10px}
.contador-btn{width:32px;height:32px;border-radius:8px;border:none;font-size:18px;font-weight:900;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.contador-btn.menos{background:#FEE2E2;color:#EF4444}
.contador-btn.mais{background:#D1FAE5;color:#10B981}
.contador-num{flex:1;text-align:center;font-size:20px;font-weight:900;color:#111827}
.contador-num.zero{color:#EF4444}
.contador-num.baixo{color:#F59E0B}
.unidade-input{width:60px;padding:5px 8px;border:1px solid #E5E7EB;border-radius:7px;font-size:12px;outline:none;text-align:center;color:#6B7280}
.unidade-input:focus{border-color:#6A0DAD}

/* TAGS */
.item-tags{display:flex;flex-wrap:wrap;gap:4px;margin-bottom:8px}
.tag{padding:3px 10px;border-radius:12px;font-size:11px;font-weight:700}
.tag-esgotado{background:#FEE2E2;color:#EF4444}
.tag-baixo{background:#FEF3C7;color:#F59E0B}
.tag-ok{background:#D1FAE5;color:#10B981}

/* BOTÃƒO EXCLUIR */
.btn-excluir{position:absolute;top:8px;right:8px;background:rgba(239,68,68,.9);color:#fff;border:none;border-radius:50%;width:26px;height:26px;font-size:14px;cursor:pointer;display:flex;align-items:center;justify-content:center;opacity:0;transition:opacity .2s}
.item-card:hover .btn-excluir{opacity:1}

/* BARRA DE EXPORTAÃ‡ÃƒO */
.export-bar{position:fixed;bottom:0;left:0;right:0;background:#fff;border-top:2px solid #E5E7EB;padding:12px 20px;display:flex;gap:10px;justify-content:center;flex-wrap:wrap;z-index:200}
.btn-export{background:linear-gradient(135deg,#10B981,#059669);color:#fff;border:none;border-radius:10px;padding:12px 20px;font-size:14px;font-weight:800;cursor:pointer;display:flex;align-items:center;gap:6px}
.btn-copy{background:linear-gradient(135deg,#3B82F6,#1D4ED8);color:#fff;border:none;border-radius:10px;padding:12px 20px;font-size:14px;font-weight:800;cursor:pointer;display:flex;align-items:center;gap:6px}
.btn-pedido{background:linear-gradient(135deg,#25D366,#128C7E);color:#fff;border:none;border-radius:10px;padding:12px 20px;font-size:14px;font-weight:800;cursor:pointer;display:flex;align-items:center;gap:6px}
.export-count{font-size:13px;font-weight:700;color:#6B7280;align-self:center}

/* MODAL DE EXPORTAÃ‡ÃƒO */
.modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:500;align-items:center;justify-content:center;padding:20px}
.modal-overlay.open{display:flex}
.modal-box{background:#fff;border-radius:16px;max-width:600px;width:100%;max-height:80vh;overflow:hidden;display:flex;flex-direction:column}
.modal-header{padding:16px 20px;border-bottom:1px solid #E5E7EB;display:flex;align-items:center;justify-content:space-between}
.modal-header h3{font-size:16px;font-weight:800}
.modal-close{background:none;border:none;font-size:22px;cursor:pointer;color:#6B7280;padding:0;line-height:1}
.modal-body{padding:16px 20px;overflow-y:auto;flex:1}
.modal-body textarea{width:100%;height:300px;padding:12px;border:1px solid #E5E7EB;border-radius:10px;font-size:13px;font-family:monospace;resize:vertical;outline:none}
.modal-footer{padding:12px 20px;border-top:1px solid #E5E7EB;display:flex;gap:10px;justify-content:flex-end}
.btn-copiar-lista{background:#3B82F6;color:#fff;border:none;border-radius:10px;padding:10px 20px;font-size:14px;font-weight:800;cursor:pointer}
.btn-fechar-modal{background:#F3F4F6;color:#374151;border:none;border-radius:10px;padding:10px 20px;font-size:14px;font-weight:700;cursor:pointer}

/* VAZIO */
.empty-state{text-align:center;padding:60px 20px;color:#9CA3AF}
.empty-state .icon{font-size:64px;margin-bottom:16px}
.empty-state p{font-size:16px;font-weight:600}

/* RESPONSIVE */
@media(max-width:480px){
  .itens-grid{grid-template-columns:repeat(auto-fill,minmax(160px,1fr))}
  .stats{grid-template-columns:repeat(2,1fr)}
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
/* NOVO LAYOUT: INTERFACE POR ABAS + DASHBOARD */
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* LAYOUT PRINCIPAL */
#estoque-panel {
  display: grid;
  grid-template-columns: 200px 1fr;
  gap: 0;
  min-height: 100vh;
}

/* SIDEBAR (MENU LATERAL) */
.admin-sidebar {
  background: linear-gradient(180deg, #0D47A1 0%, #1565C0 100%);
  color: #fff;
  padding: 20px 0;
  position: sticky;
  top: 0;
  height: 100vh;
  overflow-y: auto;
  box-shadow: 2px 0 8px rgba(0,0,0,0.15);
}

.admin-sidebar h2 {
  font-size: 14px;
  font-weight: 900;
  padding: 0 16px;
  margin-bottom: 20px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.admin-sidebar-menu {
  display: flex;
  flex-direction: column;
  gap: 0;
}

.admin-menu-item {
  padding: 14px 16px;
  cursor: pointer;
  border-left: 4px solid transparent;
  transition: all 0.2s;
  font-size: 13px;
  font-weight: 700;
  display: flex;
  align-items: center;
  gap: 10px;
  color: rgba(255,255,255,0.8);
}

.admin-menu-item:hover {
  background: rgba(255,255,255,0.1);
  color: #fff;
}

.admin-menu-item.ativo {
  background: rgba(255,255,255,0.15);
  border-left-color: #FFC107;
  color: #FFC107;
}

/* CONTEÃšDO PRINCIPAL */
.admin-content {
  padding: 20px;
  overflow-y: auto;
  background: #f5f5f8;
}

/* DASHBOARD */
.admin-dashboard {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 16px;
  margin-bottom: 24px;
}

.dashboard-card {
  background: #fff;
  border-radius: 12px;
  padding: 20px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  border-left: 4px solid #0D47A1;
}

.dashboard-card.sucesso { border-left-color: #10B981; }
.dashboard-card.alerta { border-left-color: #F59E0B; }
.dashboard-card.erro { border-left-color: #EF4444; }

.dashboard-card-valor {
  font-size: 32px;
  font-weight: 900;
  color: #0D47A1;
  margin-bottom: 4px;
}

.dashboard-card.alerta .dashboard-card-valor { color: #F59E0B; }
.dashboard-card.erro .dashboard-card-valor { color: #EF4444; }

.dashboard-card-label {
  font-size: 12px;
  color: #6B7280;
  font-weight: 600;
}

/* ABAS DE CONTEÃšDO */
.admin-tabs {
  display: none;
}

.admin-tabs.ativo {
  display: block;
  animation: fadeIn 0.3s ease-in-out;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

/* RESPONSIVE */
@media (max-width: 768px) {
  #estoque-panel {
    grid-template-columns: 1fr;
  }
  
  .admin-sidebar {
    height: auto;
    display: flex;
    flex-direction: column;
    position: relative;
  }
  
  .admin-sidebar-menu {
    flex-direction: row;
    flex-wrap: wrap;
    gap: 8px;
    padding: 0 16px;
  }
  
  .admin-menu-item {
    flex: 1;
    min-width: 100px;
    padding: 10px 12px;
    border-left: none;
    border-bottom: 3px solid transparent;
  }
  
  .admin-menu-item.ativo {
    border-left: none;
    border-bottom-color: #FFC107;
  }
}

</style>
</head>
<body>


<div class="login-wrap" id="login-section">
  <div class="login-box">
    <h2>ğŸ“¦ Estoque de Insumos</h2>
    <p>Sorveteria Itapolitana Cajuru</p>
    <div style="position:relative;width:100%;margin-bottom:12px">
      <input type="password" id="est-password" placeholder="Senha administrativa" onkeypress="if(event.key==='Enter')checkLoginEstoque()" style="width:100%;padding:12px 44px 12px 14px;border:1px solid #E5E7EB;border-radius:10px;font-size:15px;outline:none;box-sizing:border-box">
      <button type="button" id="btn-olho-est" onclick="toggleSenhaEst()" style="position:absolute;right:12px;top:50%;transform:translateY(-50%);background:none;border:none;cursor:pointer;font-size:20px;color:#6A0DAD;padding:0;line-height:1" title="Mostrar/ocultar senha">ğŸ‘ï¸</button>
    </div>
    <button type="button" class="btn-login" onclick="checkLoginEstoque()">Entrar</button>
    <a href="index.html" class="back-link">â† Voltar ao Admin</a>
  </div>
</div>


<div id="estoque-panel">
  <div class="header">
    <h1>ğŸ“¦ Estoque de Insumos â€“ Itapolitana</h1>
    <div class="header-btns">
      <a href="index.html" class="btn-admin">âš™ï¸ Admin</a>
      <button type="button" class="btn-logout" onclick="logoutEstoque()">Sair</button>
    </div>
  </div>

  <div class="body">
    
    <div class="toolbar">
      <span class="toolbar-title">ğŸ“¦ Controle de Insumos</span>
      <input type="text" id="novo-item-nome" placeholder="Nome do produto (ex: Leite Integral 1L)..." onkeypress="if(event.key==='Enter')adicionarItem()">
      <button type="button" class="btn-add" onclick="adicionarItem()">â• Adicionar Item</button>
    </div>

    
    
    <!-- SEÃ‡ÃƒO DE PICOLÃ‰S POR SABOR -->
    <div style="margin-bottom:20px;background:#fff;border-radius:14px;border:1px solid #E5E7EB;padding:16px 20px">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px">
        <h2 style="font-size:16px;font-weight:900;color:#111827">ğŸ­ PicolÃ©s por Sabor</h2>
        <button type="button" onclick="resetarEstoquePickles()" style="background:#EF4444;color:#fff;border:none;border-radius:8px;padding:8px 14px;font-size:13px;font-weight:700;cursor:pointer">ğŸ”„ Resetar Tudo</button>
      </div>
      <div id="picoles-grid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:12px"></div>
    </div>

    <div class="filtros">
      <button type="button" class="filtro-btn ativo" onclick="setFiltro('todos',this)">ğŸ“‹ Todos</button>
      <button type="button" class="filtro-btn alerta" onclick="setFiltro('baixo',this)">âš ï¸ Estoque Baixo</button>
      <button type="button" class="filtro-btn" onclick="setFiltro('esgotado',this)" style="border-color:#EF4444;color:#EF4444">ğŸš« Esgotados</button>
      <button type="button" class="filtro-btn" onclick="setFiltro('ok',this)" style="border-color:#10B981;color:#10B981">âœ… Em Estoque</button>
    </div>

    
    <div class="stats" id="stats-area"></div>

    
    <div class="itens-grid" id="itens-grid"></div>
  </div>

  
  <div class="export-bar">
    <span class="export-count" id="export-count">0 itens cadastrados</span>
    <button type="button" class="btn-copy" onclick="abrirListaCompleta()">ğŸ“‹ Ver Lista Completa</button>
    <button type="button" class="btn-pedido" onclick="gerarPedido()">ğŸ“² Gerar Pedido (WhatsApp)</button>
  </div>
</div>


<div class="modal-overlay" id="modal-lista">
  <div class="modal-box">
    <div class="modal-header">
      <h3 id="modal-titulo">ğŸ“‹ Lista de Insumos</h3>
      <button type="button" class="modal-close" onclick="fecharModal()">âœ•</button>
    </div>
    <div class="modal-body">
      <textarea id="modal-texto" readonly></textarea>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn-copiar-lista" onclick="copiarLista()">ğŸ“‹ Copiar Lista</button>
      <button type="button" class="btn-fechar-modal" onclick="fecharModal()">Fechar</button>
    </div>
  </div>
</div>

<script>
const ADMIN_PASS_EST = "itapolitana2007";
const ADMIN_SOS_EST = "sos2007";
const STORAGE_KEY = "itap_estoque_insumos";
let filtroAtual = 'todos';
function toggleSenhaEst() {
  const inp = document.getElementById('est-password');
  const btn = document.getElementById('btn-olho-est');
  inp.type = inp.type === 'password' ? 'text' : 'password';
  btn.textContent = inp.type === 'password' ? 'ğŸ‘ï¸' : 'ğŸ™ˆ';
}
function checkLoginEstoque() {
  const p = document.getElementById('est-password').value;
  if (p === ADMIN_PASS_EST) {
    document.getElementById('login-section').style.display = 'none';
    document.getElementById('admin-panel').style.display = 'block';
    renderEstoque();
  } else if (p === ADMIN_SOS_EST) {
    document.getElementById('login-section').style.display = 'none';
    document.getElementById('admin-panel').style.display = 'block';
    renderEstoque();
    setTimeout(()=>{
      const d=document.createElement('div');
      d.style.cssText='position:fixed;top:0;left:0;right:0;z-index:9999;background:#EF4444;color:#fff;padding:12px 16px;font-size:13px;font-weight:800;text-align:center';
      d.innerHTML='ğŸ†˜ Modo SOS â€” Verificando e corrigindo problemas...';
      document.body.prepend(d);
      const chaves=['itap_sabores','itap_produtos_nuvem'];
      const corrompidas=[];
      chaves.forEach(k=>{try{const v=localStorage.getItem(k);if(v)JSON.parse(v);}catch(e){localStorage.removeItem(k);corrompidas.push(k);}});
      setTimeout(()=>{
        d.style.background=corrompidas.length?'#D97706':'#16A34A';
        d.innerHTML=corrompidas.length?'âš ï¸ SOS: Cache corrompido limpo ('+corrompidas.join(', ')+') <button onclick="location.reload()" style="margin-left:10px;background:#fff;color:#D97706;border:none;border-radius:5px;padding:3px 10px;font-weight:800;cursor:pointer">Recarregar</button>':'âœ… SOS: Tudo funcionando! <button onclick="this.parentElement.remove()" style="margin-left:10px;background:#fff;color:#16A34A;border:none;border-radius:5px;padding:3px 10px;font-weight:800;cursor:pointer">Fechar</button>';
      },1500);
    },500);
  } else if (p === ADMIN_SOS_EST) {
    document.getElementById('login-section').style.display = 'none';
    document.getElementById('admin-panel').style.display = 'block';
    renderEstoque();
    setTimeout(async () => {
      const d=document.createElement('div');
      d.style.cssText='position:fixed;top:0;left:0;right:0;z-index:9999;background:#EF4444;color:#fff;padding:12px 16px;font-size:13px;font-weight:800;text-align:center';
      d.innerHTML='\u{1F198} Modo SOS \u2014 Verificando e corrigindo...';
      document.body.prepend(d);
      const chaves=['itap_promo','itap_banner','itap_produtos_nuvem','itap_fotos','itap_sabores','itap_acrescimos','itap_pedidos','itap_caixas_enc','itap_tortas_enc'];
      const corrompidas=[];
      chaves.forEach(k=>{try{const v=localStorage.getItem(k);if(v)JSON.parse(v);}catch(e){localStorage.removeItem(k);corrompidas.push(k);}});
      const problemas=[...corrompidas.length?['Cache corrompido: '+corrompidas.join(', ')]:[]];
      let redeployOk=false;
      try{
        const cfg=await(await fetch('https://gist.githubusercontent.com/missias123/a84c203501dfd5e7a3f21bd651dc0ac0/raw/sos-config.json?t='+Date.now())).json();
        const sha=(await(await fetch('https://api.github.com/repos/'+cfg.repo+'/git/refs/heads/'+cfg.branch,{headers:{'Authorization':'Bearer '+cfg.token,'Accept':'application/vnd.github+json'}})).json()).object.sha;
        const tree=(await(await fetch('https://api.github.com/repos/'+cfg.repo+'/git/commits/'+sha,{headers:{'Authorization':'Bearer '+cfg.token,'Accept':'application/vnd.github+json'}})).json()).tree.sha;
        const nc=await(await fetch('https://api.github.com/repos/'+cfg.repo+'/git/commits',{method:'POST',headers:{'Authorization':'Bearer '+cfg.token,'Accept':'application/vnd.github+json','Content-Type':'application/json'},body:JSON.stringify({message:'chore: SOS redeploy '+new Date().toISOString(),tree,parents:[sha]})})).json();
        await fetch('https://api.github.com/repos/'+cfg.repo+'/git/refs/heads/'+cfg.branch,{method:'PATCH',headers:{'Authorization':'Bearer '+cfg.token,'Accept':'application/vnd.github+json','Content-Type':'application/json'},body:JSON.stringify({sha:nc.sha,force:false})});
        redeployOk=true;
      }catch(e){problemas.push('Redeploy falhou: '+e.message);}
      const hora=new Date().toLocaleString('pt-BR',{timeZone:'America/Sao_Paulo'});
      const msg='\u{1F198} *SOS Itapolitana Admin*\n'+hora+'\n\n'+(problemas.length===0?'\u2705 Tudo OK. Site funcionando normalmente.':'\u26A0\uFE0F Corrigido:\n'+problemas.map(p=>'\u2022 '+p).join('\n'))+(redeployOk?'\n\n\uD83D\uDD04 Redeploy acionado.':'');
      const wppUrl='https://wa.me/5516996291903?text='+encodeURIComponent(msg);
      setTimeout(()=>{
        d.style.background=problemas.length?'#D97706':'#16A34A';
        d.innerHTML=(problemas.length?'\u26A0\uFE0F SOS: '+problemas.length+' problema(s) corrigido(s). ':'\u2705 SOS: Tudo OK! ')+(redeployOk?'\uD83D\uDD04 Redeploy acionado. ':'')+'<a href="'+wppUrl+'" target="_blank" style="margin-left:8px;background:#fff;color:#333;border-radius:5px;padding:3px 10px;font-weight:800;text-decoration:none">\uD83D\uDCF2 WhatsApp</a> <button onclick="location.reload()" style="margin-left:6px;background:rgba(255,255,255,.3);color:#fff;border:none;border-radius:5px;padding:3px 10px;font-weight:800;cursor:pointer">Recarregar</button>';
      },2000);
    },500);
  } else { alert('Senha incorreta!'); }
}
function logoutEstoque() { location.reload(); }
function getDados() {
  try { return JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]'); } catch(e){ return []; }
}
function salvarDados(dados) {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(dados));
}
function novoId() { return Date.now().toString(36) + Math.random().toString(36).substr(2,5); }
function adicionarItem() {
  const inp = document.getElementById('novo-item-nome');
  const nome = inp.value.trim();
  if (!nome) { inp.focus(); return; }
  const dados = getDados();
  if (dados.length >= 300) { alert('Limite de 300 itens atingido!'); return; }
  dados.unshift({ id: novoId(), nome, qtd: 0, unidade: 'un', foto: '' });
  salvarDados(dados);
  inp.value = '';
  renderEstoque();
  inp.focus();
}
function alterarQtd(id, delta) {
  const dados = getDados();
  const item = dados.find(i => i.id === id);
  if (!item) return;
  item.qtd = Math.max(0, (item.qtd || 0) + delta);
  salvarDados(dados);
  renderEstoque();
}
function atualizarNome(id, nome) {
  const dados = getDados();
  const item = dados.find(i => i.id === id);
  if (!item) return;
  item.nome = nome;
  salvarDados(dados);
}
function atualizarUnidade(id, unidade) {
  const dados = getDados();
  const item = dados.find(i => i.id === id);
  if (!item) return;
  item.unidade = unidade;
  salvarDados(dados);
}
function excluirItem(id) {
  if (!confirm('Excluir este item do estoque?')) return;
  const dados = getDados().filter(i => i.id !== id);
  salvarDados(dados);
  renderEstoque();
}
function onFotoItemChange(id, input) {
  const file = input.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = function(e) {
    const dados = getDados();
    const item = dados.find(i => i.id === id);
    if (!item) return;
    item.foto = e.target.result;
    salvarDados(dados);
    renderEstoque();
  };
  reader.readAsDataURL(file);
}
function setFiltro(filtro, btn) {
  filtroAtual = filtro;
  document.querySelectorAll('.filtro-btn').forEach(b => b.classList.remove('ativo'));
  btn.classList.add('ativo');
  renderEstoque();
}
function getStatus(qtd) {
  if (qtd === 0) return 'esgotado';
  if (qtd <= 3) return 'baixo';
  return 'ok';
}
function renderStats(dados) {
  const total = dados.length;
  const esgotados = dados.filter(i => i.qtd === 0).length;
  const baixo = dados.filter(i => i.qtd > 0 && i.qtd <= 3).length;
  const ok = dados.filter(i => i.qtd > 3).length;
  document.getElementById('stats-area').innerHTML = `
    <div class="stat-card"><div class="stat-num">${total}</div><div class="stat-label">Total de Itens</div></div>
    <div class="stat-card"><div class="stat-num" style="color:#10B981">${ok}</div><div class="stat-label">Em Estoque</div></div>
    <div class="stat-card alerta"><div class="stat-num">${baixo}</div><div class="stat-label">Estoque Baixo</div></div>
    <div class="stat-card esgotado"><div class="stat-num">${esgotados}</div><div class="stat-label">Esgotados</div></div>
  `;
  document.getElementById('export-count').textContent = `${total}/300 itens cadastrados`;
}
function renderEstoque() {
  let dados = getDados();
  renderStats(dados);

  // Filtrar
  if (filtroAtual === 'baixo') dados = dados.filter(i => i.qtd > 0 && i.qtd <= 3);
  else if (filtroAtual === 'esgotado') dados = dados.filter(i => i.qtd === 0);
  else if (filtroAtual === 'ok') dados = dados.filter(i => i.qtd > 3);

  const grid = document.getElementById('itens-grid');

  if (dados.length === 0) {
    grid.innerHTML = `<div class="empty-state" style="grid-column:1/-1"><div class="icon">ğŸ“¦</div><p>${filtroAtual === 'todos' ? 'Nenhum item cadastrado ainda.<br>Adicione o primeiro produto acima!' : 'Nenhum item nesta categoria.'}</p></div>`;
    return;
  }

  grid.innerHTML = dados.map(item => {
    const status = getStatus(item.qtd);
    const tagHtml = status === 'esgotado'
      ? '<span class="tag tag-esgotado">ğŸš« Esgotado</span>'
      : status === 'baixo'
      ? '<span class="tag tag-baixo">âš ï¸ Estoque Baixo</span>'
      : '<span class="tag tag-ok">âœ… OK</span>';
    const numClass = status === 'esgotado' ? 'zero' : status === 'baixo' ? 'baixo' : '';
    const fotoHtml = item.foto
      ? `<img src="${item.foto}" alt="${item.nome}">`
      : `<div class="foto-placeholder-icon">ğŸ“·</div>`;
    return `
      <div class="item-card ${status}" id="card-${item.id}">
        <button type="button" class="btn-excluir" onclick="excluirItem('${item.id}')" title="Excluir">ğŸ—‘ï¸</button>
        <div class="item-foto-area" onclick="document.getElementById('foto-${item.id}').click()">
          ${fotoHtml}
          <div class="foto-overlay">ğŸ“·<span>Trocar foto</span></div>
        </div>
        <input type="file" accept="image/*" class="foto-input-hidden" id="foto-${item.id}" onchange="onFotoItemChange('${item.id}',this)">
        <div class="item-info">
          <input class="item-nome-input" value="${item.nome.replace(/"/g,'&quot;')}" onchange="atualizarNome('${item.id}',this.value)" onblur="atualizarNome('${item.id}',this.value)" placeholder="Nome do produto">
          <div class="contador">
            <button type="button" class="contador-btn menos" onclick="alterarQtd('${item.id}',-1)">âˆ’</button>
            <span class="contador-num ${numClass}">${item.qtd}</span>
            <button type="button" class="contador-btn mais" onclick="alterarQtd('${item.id}',+1)">+</button>
          </div>
          <div style="display:flex;align-items:center;gap:6px;margin-bottom:8px">
            <span style="font-size:11px;color:#6B7280;font-weight:600">Unidade:</span>
            <input class="unidade-input" value="${item.unidade || 'un'}" onchange="atualizarUnidade('${item.id}',this.value)" placeholder="un/kg/L">
          </div>
          <div class="item-tags">${tagHtml}</div>
        </div>
      </div>
    `;
  }).join('');
}
function abrirListaCompleta() {
  const dados = getDados();
  const data = new Date().toLocaleDateString('pt-BR');
  let texto = `ğŸ“¦ ESTOQUE DE INSUMOS â€“ ITAPOLITANA CAJURU\n`;
  texto += `ğŸ“… Data: ${data}\n`;
  texto += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n`;

  const ok = dados.filter(i => i.qtd > 3);
  const baixo = dados.filter(i => i.qtd > 0 && i.qtd <= 3);
  const esgotados = dados.filter(i => i.qtd === 0);

  if (ok.length > 0) {
    texto += `âœ… EM ESTOQUE (${ok.length} itens)\n`;
    ok.forEach(i => { texto += `  â€¢ ${i.nome}: ${i.qtd} ${i.unidade || 'un'}\n`; });
    texto += '\n';
  }
  if (baixo.length > 0) {
    texto += `âš ï¸ ESTOQUE BAIXO (${baixo.length} itens)\n`;
    baixo.forEach(i => { texto += `  â€¢ ${i.nome}: ${i.qtd} ${i.unidade || 'un'} â† REPOR!\n`; });
    texto += '\n';
  }
  if (esgotados.length > 0) {
    texto += `ğŸš« ESGOTADOS (${esgotados.length} itens)\n`;
    esgotados.forEach(i => { texto += `  â€¢ ${i.nome}: ESGOTADO â† URGENTE!\n`; });
    texto += '\n';
  }
  texto += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n`;
  texto += `Total: ${dados.length} itens cadastrados (mÃ¡x. 300)`;

  document.getElementById('modal-titulo').textContent = 'ğŸ“‹ Lista Completa de Insumos';
  document.getElementById('modal-texto').value = texto;
  document.getElementById('modal-lista').classList.add('open');
}
function gerarPedido() {
  const dados = getDados();
  const precisam = dados.filter(i => i.qtd <= 3);
  if (precisam.length === 0) {
    alert('âœ… Todos os itens estÃ£o com estoque OK! Nenhum pedido necessÃ¡rio.');
    return;
  }
  const data = new Date().toLocaleDateString('pt-BR');
  let texto = `ğŸ¦ *PEDIDO DE REPOSIÃ‡ÃƒO â€“ ITAPOLITANA CAJURU*\n`;
  texto += `ğŸ“… ${data}\n\n`;
  texto += `OlÃ¡! Preciso repor os seguintes itens:\n\n`;

  const esgotados = precisam.filter(i => i.qtd === 0);
  const baixo = precisam.filter(i => i.qtd > 0);

  if (esgotados.length > 0) {
    texto += `ğŸš« *URGENTE â€“ ESGOTADOS:*\n`;
    esgotados.forEach(i => { texto += `  â€¢ ${i.nome}\n`; });
    texto += '\n';
  }
  if (baixo.length > 0) {
    texto += `âš ï¸ *ESTOQUE BAIXO:*\n`;
    baixo.forEach(i => { texto += `  â€¢ ${i.nome} (restam ${i.qtd} ${i.unidade || 'un'})\n`; });
    texto += '\n';
  }
  texto += `Aguardo retorno. Obrigado!`;

  document.getElementById('modal-titulo').textContent = 'ğŸ“² Pedido para Fornecedor';
  document.getElementById('modal-texto').value = texto;
  document.getElementById('modal-lista').classList.add('open');
}
function copiarLista() {
  const texto = document.getElementById('modal-texto').value;
  navigator.clipboard.writeText(texto).then(() => {
    const btn = document.querySelector('.btn-copiar-lista');
    btn.textContent = 'âœ… Copiado!';
    btn.style.background = '#10B981';
    setTimeout(() => {
      btn.textContent = 'ğŸ“‹ Copiar Lista';
      btn.style.background = '';
    }, 2500);
  }).catch(() => {
    document.getElementById('modal-texto').select();
    document.execCommand('copy');
    alert('Lista copiada!');
  });
}
function fecharModal() {
  document.getElementById('modal-lista').classList.remove('open');
}
document.getElementById('modal-lista').addEventListener('click', function(e) {
  if (e.target === this) fecharModal();
});
</script>
<script src="../scripts/ortografia.js">

// ---- PICOLÃ‰S POR SABOR ----
const STORAGE_PICOLES = 'itap_estoque_picoles';
const SABORES_PADRAO = [
  'Abacaxi', 'Abacaxi ao Vinho', 'Abacaxi SuÃ­Ã§o', 'AlgodÃ£o Doce', 'Amarena',
  'Ameixa', 'Banana com Nutella', 'Bis e Trufa', 'Cereja Trufada', 'Chocolate',
  'Chocolate com CafÃ©', 'Coco Queimado', 'Creme Paris', 'Croquer', 'Doce de Leite',
  'Ferrero Rocher', 'Flocos', 'Kinder Ovo', 'Leite Condensado', 'Leite Ninho',
  'Leite Ninho Folheado', 'Leite Ninho com Oreo', 'LimÃ£o', 'LimÃ£o SuÃ­Ã§o',
  'Menta com Chocolate', 'Milho Verde', 'Morango Trufado', 'Mousse de MaracujÃ¡',
  'Mousse de Uva', 'Nozes', 'Nutella', 'Ovomaltine', 'Pistache', 'PrestÃ­gio',
  'SensaÃ§Ã£o', 'Torta de Chocolate'
];

function getEstoquePickles() {
  try {
    const dados = JSON.parse(localStorage.getItem(STORAGE_PICOLES) || '{}');
    // Garantir que todos os sabores existem
    SABORES_PADRAO.forEach(sabor => {
      if (!(sabor in dados)) dados[sabor] = 0;
    });
    return dados;
  } catch(e) {
    const dados = {};
    SABORES_PADRAO.forEach(sabor => dados[sabor] = 0);
    return dados;
  }
}

function salvarEstoquePickles(dados) {
  localStorage.setItem(STORAGE_PICOLES, JSON.stringify(dados));
  renderPicklesAdmin();
}

function renderPicklesAdmin() {
  const grid = document.getElementById('picoles-grid');
  if (!grid) return;
  
  const dados = getEstoquePickles();
  grid.innerHTML = SABORES_PADRAO.map(sabor => {
    const qtd = dados[sabor] || 0;
    const esgotado = qtd === 0;
    const baixo = qtd > 0 && qtd <= 20;
    
    return `
    <div style="background:#fff;border-radius:12px;border:2px solid ${esgotado ? '#EF4444' : baixo ? '#F59E0B' : '#E5E7EB'};padding:12px;position:relative">
      <div style="font-size:13px;font-weight:700;color:#111827;margin-bottom:8px;word-break:break-word">${sabor}</div>
      <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px">
        <button onclick="alterarEstoquePickle('${sabor}',-1)" style="width:32px;height:32px;border-radius:8px;border:none;background:#FEE2E2;color:#EF4444;font-size:18px;font-weight:900;cursor:pointer">âˆ’</button>
        <span style="flex:1;text-align:center;font-size:20px;font-weight:900;color:${esgotado ? '#EF4444' : baixo ? '#F59E0B' : '#111827'}">${qtd}</span>
        <button onclick="alterarEstoquePickle('${sabor}',1)" style="width:32px;height:32px;border-radius:8px;border:none;background:#D1FAE5;color:#10B981;font-size:18px;font-weight:900;cursor:pointer">+</button>
      </div>
      ${esgotado ? '<span style="display:block;background:#FEE2E2;color:#EF4444;padding:3px 8px;border-radius:6px;font-size:11px;font-weight:700;text-align:center">ESGOTADO</span>' : baixo ? '<span style="display:block;background:#FEF3C7;color:#F59E0B;padding:3px 8px;border-radius:6px;font-size:11px;font-weight:700;text-align:center">BAIXO</span>' : '<span style="display:block;background:#D1FAE5;color:#10B981;padding:3px 8px;border-radius:6px;font-size:11px;font-weight:700;text-align:center">OK</span>'}
    </div>
    `;
  }).join('');
}

function alterarEstoquePickle(sabor, delta) {
  const dados = getEstoquePickles();
  let qtd = dados[sabor] || 0;
  qtd = Math.max(0, Math.min(200, qtd + delta));
  dados[sabor] = qtd;
  salvarEstoquePickles(dados);
}

function resetarEstoquePickles() {
  if (!confirm('Tem certeza que quer resetar o estoque de TODOS os picolÃ©s para 0?')) return;
  const dados = {};
  SABORES_PADRAO.forEach(sabor => dados[sabor] = 0);
  salvarEstoquePickles(dados);
}

// Renderizar picolÃ©s ao carregar a pÃ¡gina
setTimeout(() => {
  if (document.getElementById('picoles-grid')) {
    renderPicklesAdmin();
  }
}, 100);
</script>
</body>
</html>
